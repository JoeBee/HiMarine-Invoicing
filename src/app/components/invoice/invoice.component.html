<div class="invoice-container" [ngClass]="{ 'eos-theme': selectedBank === 'EOS' }">
    <div class="content-wrapper">
        <!-- Top Logo Section with Export Buttons -->
        <div class="top-section">
            <div class="company-logo">
                <img [src]="selectedBank === 'EOS' ? 'assets/images/EosSupplyLtd.png' : 'assets/images/HIMarineTopImage.png'"
                    alt="Company Logo" class="top-logo">
            </div>
            <div class="export-buttons-section">
                <button class="export-btn excel-btn" [disabled]="invoiceData.items.length === 0"
                    (click)="exportInvoiceToExcel()">
                    <span class="btn-icon">ðŸ“Š</span>
                    Export Invoice
                </button>
                <button class="export-btn pdf-btn" *ngIf="false" [disabled]="invoiceData.items.length === 0"
                    (click)="exportInvoiceToPDF()">
                    <span class="btn-icon">ðŸ“„</span>
                    Export to PDF
                </button>
            </div>
        </div>

        <!-- Selection and Fees Section -->
        <div class="selection-fees-section">
            <!-- Bank Selection Radio Buttons - Left Half -->
            <div class="bank-selection-section">
                <h3>Categories:</h3>
                <div class="radio-group">
                    <label class="radio-option">
                        <input type="radio" name="bankSelection" value="" [(ngModel)]="selectedBank"
                            (change)="onBankSelectionChange()">
                        <span class="radio-label">Blank</span>
                    </label>
                    <label class="radio-option">
                        <input type="radio" name="bankSelection" value="US" [(ngModel)]="selectedBank"
                            (change)="onBankSelectionChange()">
                        <span class="radio-label">US</span>
                    </label>
                    <label class="radio-option">
                        <input type="radio" name="bankSelection" value="UK" [(ngModel)]="selectedBank"
                            (change)="onBankSelectionChange()">
                        <span class="radio-label">UK</span>
                    </label>
                    <label class="radio-option">
                        <input type="radio" name="bankSelection" value="EOS" [(ngModel)]="selectedBank"
                            (change)="onBankSelectionChange()">
                        <span class="radio-label">EOS</span>
                    </label>
                </div>
            </div>

            <!-- Fees Section - Right Half -->
            <div class="fees-section">
                <h3>Fees & Discounts:</h3>
                <div class="fees-grid">
                    <div class="fee-field">
                        <label>Delivery fee:</label>
                        <input type="number" step="0.1" [(ngModel)]="invoiceData.deliveryFee"
                            (ngModelChange)="calculateTotals()" class="editable-field"
                            [ngClass]="selectedBank === 'EOS' ? 'eos-highlight' : ''">
                    </div>
                    <div class="fee-field">
                        <label>Port fee:</label>
                        <input type="number" step="0.1" [(ngModel)]="invoiceData.portFee"
                            (ngModelChange)="calculateTotals()" class="editable-field"
                            [ngClass]="selectedBank === 'EOS' ? 'eos-highlight' : ''">
                    </div>
                    <div class="fee-field">
                        <label>Agency fee:</label>
                        <input type="number" step="0.1" [(ngModel)]="invoiceData.agencyFee"
                            (ngModelChange)="calculateTotals()" class="editable-field"
                            [ngClass]="selectedBank === 'EOS' ? 'eos-highlight' : ''">
                    </div>
                    <div class="fee-field">
                        <label>Transport, Customs, Launch fees:</label>
                        <input type="number" step="0.1" [(ngModel)]="invoiceData.transportCustomsLaunchFees"
                            (ngModelChange)="calculateTotals()" class="editable-field"
                            [ngClass]="selectedBank === 'EOS' ? 'eos-highlight' : ''">
                    </div>
                    <div class="fee-field">
                        <label>Launch:</label>
                        <input type="number" step="0.1" [(ngModel)]="invoiceData.launchFee"
                            (ngModelChange)="calculateTotals()" class="editable-field">
                    </div>
                    <div class="fee-field">
                        <label>Discount (%):</label>
                        <input type="number" step="0.1" [(ngModel)]="invoiceData.discountPercent"
                            (ngModelChange)="calculateTotals()" class="editable-field">
                    </div>
                </div>
            </div>
        </div>

        <!-- Main Content Section -->
        <div class="main-content">
            <!-- Left Side - Our Company Details and Bank Details -->
            <div class="left-section">
                <!-- Our Company Details Section -->
                <div class="section-box">
                    <h2 class="section-title">Our Company Details</h2>
                    <div class="company-details">
                        <div class="detail-field">
                            <label>Name:</label>
                            <input type="text" [(ngModel)]="invoiceData.ourCompanyName" class="editable-field">
                        </div>
                        <div class="detail-field">
                            <label>Address:</label>
                            <input type="text" [(ngModel)]="invoiceData.ourCompanyAddress" class="editable-field">
                        </div>
                        <div class="detail-field">
                            <label>Address 2:</label>
                            <input type="text" [(ngModel)]="invoiceData.ourCompanyAddress2" class="editable-field">
                        </div>
                        <div class="detail-field">
                            <label>City:</label>
                            <input type="text" [(ngModel)]="invoiceData.ourCompanyCity" class="editable-field">
                        </div>
                        <div class="detail-field">
                            <label>Country:</label>
                            <input type="text" [(ngModel)]="invoiceData.ourCompanyCountry" class="editable-field">
                        </div>
                        <div class="detail-field">
                            <label>Phone:</label>
                            <input type="text" [(ngModel)]="invoiceData.ourCompanyPhone" class="editable-field">
                        </div>
                        <div class="detail-field">
                            <label>Email:</label>
                            <input type="text" [(ngModel)]="invoiceData.ourCompanyEmail" class="editable-field">
                        </div>
                    </div>
                </div>

                <!-- Bank Details Section -->
                <div class="section-box">
                    <h2 class="section-title">Bank Details</h2>
                    <div class="bank-details">
                        <div class="bank-field">
                            <label>Bank Name:</label>
                            <input type="text" [(ngModel)]="invoiceData.bankName" class="editable-field">
                        </div>
                        <div class="bank-field">
                            <label>Bank Address:</label>
                            <input type="text" [(ngModel)]="invoiceData.bankAddress" class="editable-field">
                        </div>
                        <div class="bank-field">
                            <label>IBAN:</label>
                            <input type="text" [(ngModel)]="invoiceData.iban" class="editable-field">
                        </div>
                        <div class="bank-field">
                            <label>Swift Code:</label>
                            <input type="text" [(ngModel)]="invoiceData.swiftCode" class="editable-field">
                        </div>
                        <div class="bank-field">
                            <label>Title on Account:</label>
                            <input type="text" [(ngModel)]="invoiceData.accountTitle" class="editable-field">
                        </div>
                        <div class="bank-field" *ngIf="selectedBank === 'US'">
                            <label>ACH Routing:</label>
                            <input type="text" [(ngModel)]="invoiceData.achRouting" class="editable-field">
                        </div>
                        <div class="bank-field" *ngIf="selectedBank === 'EOS'">
                            <label>Intermediary BIC:</label>
                            <input type="text" [(ngModel)]="invoiceData.intermediaryBic" class="editable-field">
                        </div>
                    </div>

                    <div class="uk-domestic-wires" *ngIf="selectedBank === 'UK'">
                        <h3>UK DOMESTIC WIRES:</h3>
                        <div class="bank-field">
                            <label>Account number:</label>
                            <input type="text" [(ngModel)]="invoiceData.accountNumber" class="editable-field">
                        </div>
                        <div class="bank-field">
                            <label>Sort code:</label>
                            <input type="text" [(ngModel)]="invoiceData.sortCode" class="editable-field">
                        </div>
                    </div>
                </div>
            </div>

            <!-- Right Side - Vessel Details and Invoice Details -->
            <div class="right-section">
                <!-- Vessel Details Section -->
                <div class="section-box">
                    <h2 class="section-title">Vessel Details</h2>
                    <div class="vessel-details">
                        <div class="detail-field">
                            <label>Name:</label>
                            <input type="text" [(ngModel)]="invoiceData.vesselName" class="editable-field">
                        </div>
                        <div class="detail-field">
                            <label>Name 2:</label>
                            <input type="text" [(ngModel)]="invoiceData.vesselName2" class="editable-field">
                        </div>
                        <div class="detail-field">
                            <label>Address:</label>
                            <input type="text" [(ngModel)]="invoiceData.vesselAddress" class="editable-field">
                        </div>
                        <div class="detail-field">
                            <label>Address 2:</label>
                            <input type="text" [(ngModel)]="invoiceData.vesselAddress2" class="editable-field">
                        </div>
                        <div class="detail-field">
                            <label>City:</label>
                            <input type="text" [(ngModel)]="invoiceData.vesselCity" class="editable-field">
                        </div>
                        <div class="detail-field">
                            <label>Country:</label>
                            <input type="text" [(ngModel)]="invoiceData.vesselCountry" class="editable-field">
                        </div>
                    </div>
                </div>

                <!-- Invoice Details Section -->
                <div class="section-box">
                    <h2 class="section-title">Invoice Details</h2>
                    <div class="invoice-details">
                        <div class="invoice-field">
                            <label>No</label>
                            <input type="text" [(ngModel)]="invoiceData.invoiceNumber" class="editable-field">
                        </div>
                        <div class="invoice-field">
                            <label>Invoice Date</label>
                            <input type="date" [(ngModel)]="invoiceData.invoiceDate" class="editable-field">
                        </div>
                        <div class="invoice-field">
                            <label>Vessel</label>
                            <input type="text" [(ngModel)]="invoiceData.vessel" class="editable-field">
                        </div>
                        <div class="invoice-field">
                            <label>Country</label>
                            <select [(ngModel)]="invoiceData.country" (ngModelChange)="onCountryChange()"
                                class="editable-field">
                                <option value="">Select Country</option>
                                <option *ngFor="let country of countries" [value]="country">{{ country }}</option>
                            </select>
                        </div>
                        <div class="invoice-field">
                            <label>Port</label>
                            <!-- Text input with datalist for suggestions -->
                            <input type="text" [(ngModel)]="invoiceData.port" class="editable-field"
                                placeholder="Enter or select port name"
                                [attr.list]="availablePorts.length > 0 ? 'port-suggestions' : null">
                            <!-- Datalist for port suggestions when country is selected -->
                            <datalist *ngIf="availablePorts.length > 0" id="port-suggestions">
                                <option *ngFor="let port of availablePorts" [value]="port">
                            </datalist>
                        </div>
                        <div class="invoice-field">
                            <label>Category</label>
                            <select [(ngModel)]="invoiceData.category" class="editable-field">
                                <option value="">Select Category</option>
                                <option *ngFor="let category of categories" [value]="category">{{ category }}</option>
                            </select>
                        </div>
                        <div class="invoice-field">
                            <label>Invoice Due</label>
                            <select [(ngModel)]="invoiceData.invoiceDue" class="editable-field">
                                <option value=""></option>
                                <option value="CASH">CASH</option>
                                <option value="CREDIT">CREDIT</option>
                                <option value="30 DAYS">30 DAYS</option>
                            </select>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Items Table -->
        <div class="items-section" [ngClass]="{ 'eos-theme': selectedBank === 'EOS' }">
            <table class="items-table">
                <thead>
                    <tr>
                        <th>Pos</th>
                        <th>Tab</th>
                        <th>Description</th>
                        <th>Remark</th>
                        <th>Unit</th>
                        <th>Qty</th>
                        <th>Price</th>
                        <th>Total</th>
                    </tr>
                </thead>
                <tbody>
                    <tr *ngFor="let item of invoiceData.items">
                        <td>{{ item.pos }}</td>
                        <td>{{ item.tabName }}</td>
                        <td>{{ item.description }}</td>
                        <td>{{ item.remark }}</td>
                        <td>{{ item.unit }}</td>
                        <td>{{ item.qty }}</td>
                        <td>{{ item.currency }} {{ item.price | number:'1.2-2' }}</td>
                        <td>{{ item.currency }} {{ item.total | number:'1.2-2' }}</td>
                    </tr>
                </tbody>
            </table>
        </div>

        <!-- Totals Section -->
        <div class="totals-section">
            <div class="totals-right">
                <div class="total-line">
                    <span>TOTAL {{ getCurrencyLabel(primaryCurrency) }}</span>
                    <span>{{ primaryCurrency }} {{ invoiceData.totalGBP | number:'1.2-2' }}</span>
                </div>
                <div class="total-line">
                    <span *ngIf="(invoiceData.discountPercent || 0) > 0">Discount ({{ invoiceData.discountPercent || 0
                        }} %)</span>
                    <span *ngIf="(invoiceData.discountPercent || 0) > 0">- {{ primaryCurrency }} {{
                        (invoiceData.totalGBP *
                        (invoiceData.discountPercent || 0) / 100) | number:'1.2-2' }}</span>
                </div>
                <div class="total-line" *ngIf="(invoiceData.deliveryFee || 0) > 0">
                    <span>Delivery fee</span>
                    <span>{{ primaryCurrency }} {{ invoiceData.deliveryFee | number:'1.2-2' }}</span>
                </div>
                <div class="total-line" *ngIf="(invoiceData.portFee || 0) > 0">
                    <span>Port fee</span>
                    <span>{{ primaryCurrency }} {{ invoiceData.portFee | number:'1.2-2' }}</span>
                </div>
                <div class="total-line" *ngIf="(invoiceData.agencyFee || 0) > 0">
                    <span>Agency fee</span>
                    <span>{{ primaryCurrency }} {{ invoiceData.agencyFee | number:'1.2-2' }}</span>
                </div>
                <div class="total-line" *ngIf="(invoiceData.transportCustomsLaunchFees || 0) > 0">
                    <span>Transport, Customs, Launch fees</span>
                    <span>{{ primaryCurrency }} {{ invoiceData.transportCustomsLaunchFees | number:'1.2-2' }}</span>
                </div>
                <div class="total-line" *ngIf="(invoiceData.launchFee || 0) > 0">
                    <span>Launch</span>
                    <span>{{ primaryCurrency }} {{ invoiceData.launchFee | number:'1.2-2' }}</span>
                </div>
                <div class="total-line grand-total">
                    <span></span>
                    <span>{{ primaryCurrency }} {{ invoiceData.grandTotal | number:'1.2-2' }}</span>
                </div>
            </div>
        </div>

        <!-- Terms and Conditions -->
        <div class="terms-section">
            <h3>By placing the order according to the above quotation you are accepting the following terms:</h3>
            <ol>
                <li>Credit days: 30 calendar days.</li>
                <li>Accounts not paid in this time frame will be charged 10% interest rate per month, any discount given
                    will be null and void.</li>
                <li>Should collection or legal action be required to collect past dues, fees for such action will be
                    added
                    to your account.</li>
                <li>Subject to unsold. Final weights are subject to vendor packing standards.</li>
                <li>If the transaction is canceled after the order is authorized, we have the right to collect the
                    invoice
                    without claim.</li>
            </ol>
        </div>

        <!-- Bottom Logo Section -->
        <div class="bottom-section">
            <img [src]="selectedBank === 'EOS' ? 'assets/images/EosSupplyLtdBottomBorder.png' : 'assets/images/HIMarineBottomBorder.png'"
                alt="Company Bottom Border" class="bottom-logo-image">
        </div>
    </div>
</div>