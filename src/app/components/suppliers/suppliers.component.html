<div class="suppliers-container">
    <h1>Suppliers</h1>

    <div class="drop-zone" [class.drag-over]="isDragging" (dragover)="onDragOver($event)"
        (dragleave)="onDragLeave($event)" (drop)="onDrop($event)" (click)="triggerFileInput()">
        <div class="icon">üìÅ</div>
        <p><strong>Drag and drop XLSX files here</strong></p>
        <p>or click to browse</p>
        <input type="file" id="fileInput" multiple accept=".xlsx,.xls" (change)="onFileSelect($event)"
            style="display: none;">
    </div>

    <div *ngIf="isProcessing" class="processing-message">
        <p>Processing files...</p>
    </div>

    <div *ngIf="supplierFiles.length > 0" class="files-table">
        <div class="files-header">
            <h2>Uploaded Files ({{ supplierFiles.length }})</h2>
            <button class="secondary clear-button" (click)="clearAllFiles()">
                Clear All Files
            </button>
        </div>
        <table>
            <thead>
                <tr>
                    <th class="sortable-header" (click)="sortData('fileName')">
                        File Name {{ getSortIcon('fileName') }}
                    </th>
                    <th class="sortable-header" (click)="sortData('topLeftCell')">
                        Top Left Cell {{ getSortIcon('topLeftCell') }}
                    </th>
                    <th class="sortable-header" (click)="sortData('descriptionColumn')">
                        Description Column {{ getSortIcon('descriptionColumn') }}
                    </th>
                    <th class="sortable-header" (click)="sortData('priceColumn')">
                        Price Column {{ getSortIcon('priceColumn') }}
                    </th>
                    <th class="sortable-header" (click)="sortData('unitColumn')">
                        Unit Column {{ getSortIcon('unitColumn') }}
                    </th>
                    <th class="sortable-header" (click)="sortData('rowCount')">
                        Row Count {{ getSortIcon('rowCount') }}
                    </th>
                    <th class="sortable-header status-header" (click)="sortData('status')">
                        Status {{ getSortIcon('status') }}
                    </th>
                </tr>
            </thead>
            <tbody>
                <tr *ngFor="let file of supplierFiles">
                    <td class="clickable-filename" (click)="openFile(file)">{{ file.fileName }}</td>
                    <td [class.not-found]="file.topLeftCell === 'NOT FOUND'">{{ file.topLeftCell }}</td>
                    <td [class.not-found]="file.descriptionColumn === 'NOT FOUND'">{{
                        file.descriptionHeader || file.descriptionColumn }}</td>
                    <td [class.not-found]="file.priceColumn === 'NOT FOUND'">{{ file.priceHeader
                        || file.priceColumn }}</td>
                    <td [class.not-found]="file.unitColumn === 'NOT FOUND'">{{ file.unitHeader
                        || file.unitColumn }}</td>
                    <td>{{ file.rowCount }}</td>
                    <td class="status-cell">
                        <span *ngIf="file.hasData === true" class="status-icon success">‚úì</span>
                        <span *ngIf="file.hasData === false" class="status-icon error">‚úó</span>
                        <span *ngIf="file.hasData === undefined" class="status-icon pending">-</span>
                    </td>
                </tr>
            </tbody>
        </table>
    </div>

    <!-- Custom Confirmation Dialog -->
    <div *ngIf="showConfirmDialog" class="modal-overlay" (click)="cancelClearAll()">
        <div class="confirmation-dialog" (click)="$event.stopPropagation()">
            <div class="dialog-header">
                <h3>‚ö†Ô∏è Confirm Clear All Files</h3>
            </div>
            <div class="dialog-content">
                <p>Are you sure you want to clear all uploaded files?</p>
                <p class="warning-text">This will also clear all processed data and cannot be undone.</p>
            </div>
            <div class="dialog-actions">
                <button class="secondary cancel-button" (click)="cancelClearAll()">
                    Cancel
                </button>
                <button class="danger confirm-button" (click)="confirmClearAll()">
                    Clear All Files
                </button>
            </div>
        </div>
    </div>
</div>