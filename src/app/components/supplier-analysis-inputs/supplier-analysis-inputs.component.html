<div class="supplier-analysis-inputs-container">
    <div class="content-wrapper">
        <h1>Supplier Analysis - Inputs</h1>

        <div class="instructions-section">
            <ul>
                <li><strong>Invoice:</strong> Upload <strong>one</strong> Excel file. If a file already exists, it will
                    be replaced.</li>
                <li><strong>Supplier Quotations:</strong> Upload <strong>multiple</strong> Excel files for comparison.
                </li>
                <li>All files must have matching row counts for analysis.</li>
                <li>Each file's datatable must contain column headers: Pos, Description, Remark, Unit, Qty, Price, Total
                    (punctuation and trailing 's' ignored).</li>
            </ul>
        </div>

        <div class="drop-zones-container">
            <div class="drop-zone-column">
                <div class="drop-zone" [class.drag-over]="isDragging && hoveredDropzone === 'Invoice'"
                    (dragover)="onDragOver($event, 'Invoice')" (dragleave)="onDragLeave($event)"
                    (drop)="onDrop($event, 'Invoice')" (click)="triggerFileInput('Invoice')">
                    <div class="icon">ðŸ“„</div>
                    <p><strong>Invoice</strong></p>
                    <p class="dropzone-subtext">Drop <strong>one</strong> Excel file here or click to browse</p>
                </div>
                <input type="file" id="fileInput-Invoice" accept=".xlsx,.xls,.xlsm"
                    (change)="onFileSelect($event, 'Invoice')" style="display: none;">
            </div>

            <div class="drop-zone-column">
                <div class="drop-zone" [class.drag-over]="isDragging && hoveredDropzone === 'Supplier Quotations'"
                    (dragover)="onDragOver($event, 'Supplier Quotations')" (dragleave)="onDragLeave($event)"
                    (drop)="onDrop($event, 'Supplier Quotations')" (click)="triggerFileInput('Supplier Quotations')">
                    <div class="icon">ðŸ“‹</div>
                    <p><strong>Supplier Quotations</strong></p>
                    <p class="dropzone-subtext">Drop <strong>multiple</strong> Excel files here or click to browse</p>
                </div>
                <input type="file" id="fileInput-Supplier Quotations" multiple accept=".xlsx,.xls,.xlsm"
                    (change)="onFileSelect($event, 'Supplier Quotations')" style="display: none;">
            </div>
        </div>

        <div *ngIf="isProcessing" class="processing-message">
            <p>Processing files...</p>
        </div>

        <div *ngIf="getAllFiles().length > 0" class="files-table">
            <div class="files-table-header">
                <h2>Uploaded Files</h2>
                <button type="button" class="remove-all-button" (click)="removeAllFiles()">
                    Remove All
                </button>
            </div>
            <table>
                <thead>
                    <tr>
                        <th>File Name</th>
                        <th>Category</th>
                        <th style="text-align: center;">TOP LEFT / #ROWS</th>
                        <th>Actions</th>
                        <th></th>
                    </tr>
                </thead>
                <tbody>
                    <tr *ngFor="let file of getAllFiles(); let i = index"
                        [class.invoice-row]="file.category === 'Invoice'"
                        [class.mismatch-row]="file.category === 'Supplier Quotations' && !hasMatchingRowCount(file)">
                        <td>
                            <span class="clickable-filename" (click)="openFile(file)">{{ file.fileName }}</span>
                        </td>
                        <td>{{ file.category }}</td>
                        <td class="top-left-cell" style="text-align: center;">
                            <div style="display: flex; flex-direction: column; gap: 4px; align-items: center;">
                                <input type="text" [(ngModel)]="file.topLeftCell"
                                    (input)="onTopLeftCellChange($event, file)" (blur)="validateTopLeftCell(file)"
                                    [attr.list]="(!file.topLeftCell || file.topLeftCell.trim() === '' || file.topLeftCell === 'NOT FOUND') ? ('topLeftList-' + i) : null"
                                    class="top-left-input" placeholder="e.g., A1" maxlength="3"
                                    pattern="[A-Za-z][0-9]{1,2}">
                                <datalist
                                    *ngIf="!file.topLeftCell || file.topLeftCell.trim() === '' || file.topLeftCell === 'NOT FOUND'"
                                    [attr.id]="'topLeftList-' + i">
                                    <option *ngFor="let cell of getTopLeftCellOptions()" [value]="cell">{{ cell }}
                                    </option>
                                </datalist>
                                <span class="row-count">{{ file.rowCount }}</span>
                            </div>
                        </td>
                        <td>
                            <button type="button" class="remove-button"
                                (click)="removeFile(file.fileName, file.category)">
                                Remove
                            </button>
                        </td>
                        <td class="mismatch-indicator">
                            <span *ngIf="file.category === 'Supplier Quotations' && !hasMatchingRowCount(file)"
                                class="red-x">âœ•</span>
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>
</div>